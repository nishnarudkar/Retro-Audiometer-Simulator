<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guidance System Demo - Retro Audiometer</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);
            color: #33ff33;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border: 2px solid #33ff33;
            border-radius: 10px;
        }
        
        .demo-header h1 {
            color: #ffff33;
            font-size: 24px;
            margin: 0 0 10px 0;
            text-shadow: 0 0 10px #ffff33;
        }
        
        .demo-section {
            background: #2a2a2a;
            border: 2px solid #33ff33;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .demo-section h2 {
            color: #ffaa00;
            margin: 0 0 15px 0;
            font-size: 18px;
        }
        
        .crt-display {
            background: #001100;
            border: 2px solid #33ff33;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            min-height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .crt-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(51, 255, 51, 0.1) 2px,
                rgba(51, 255, 51, 0.1) 4px
            );
            pointer-events: none;
        }
        
        .message-line {
            margin: 3px 0;
            color: #33ff33;
            text-shadow: 0 0 3px #33ff33;
        }
        
        .timestamp {
            color: #ffaa00;
        }
        
        .decision-type {
            color: #ff6666;
            font-weight: bold;
        }
        
        .parameter {
            color: #66ccff;
        }
        
        .demo-button {
            background: #33ff33;
            color: #001100;
            border: none;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
            border-radius: 5px;
        }
        
        .demo-button:hover {
            background: #44ff44;
        }
        
        .demo-button:disabled {
            background: #666666;
            color: #333333;
            cursor: not-allowed;
        }
        
        .status-panel {
            background: #002200;
            border: 1px solid #33ff33;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 11px;
        }
        
        .progress-bar {
            font-family: monospace;
            letter-spacing: 1px;
            color: #33ff33;
        }
        
        .typewriter {
            overflow: hidden;
            border-right: 2px solid #33ff33;
            white-space: nowrap;
            animation: typing 2s steps(40, end), blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: #33ff33; }
        }
        
        .led-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 5px;
            background: #333333;
            border: 1px solid #666666;
        }
        
        .led-indicator.active {
            box-shadow: 0 0 10px currentColor;
        }
        
        .led-indicator.yellow { color: #ffff33; }
        .led-indicator.blue { color: #3366ff; }
        .led-indicator.green { color: #33ff33; }
        .led-indicator.red { color: #ff3333; }
        
        .led-indicator.active.yellow { background: #ffff33; }
        .led-indicator.active.blue { background: #3366ff; }
        .led-indicator.active.green { background: #33ff33; }
        .led-indicator.active.red { background: #ff3333; }
        
        .led-indicator.pulsing {
            animation: pulse 1s ease-in-out infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>RETRO AUDIOMETER GUIDANCE SYSTEM DEMO</h1>
            <p>Experience the 1970s clinical interface with modern AI guidance</p>
        </div>
        
        <div class="demo-section">
            <h2>1. CRT Status Display</h2>
            <div class="crt-display" id="crt-display">
                <div class="message-line">> AUDIOMETER AI v1.0</div>
                <div class="message-line"></div>
                <div class="message-line">STATUS: <span id="status">READY</span></div>
                <div class="message-line">MODE:   AUTONOMOUS</div>
                <div class="message-line">FREQ:   <span id="freq">1000</span> Hz</div>
                <div class="message-line">LEVEL:  <span id="level">40</span> dB HL</div>
                <div class="message-line">EAR:    <span id="ear">RIGHT</span></div>
                <div class="message-line">AI:     <span id="ai-status">INITIALIZING...</span></div>
                <div class="message-line"></div>
                <div class="message-line">AI> <span id="ai-command">SYSTEM READY FOR AUTONOMOUS TESTING</span></div>
                <div class="message-line">PROGRESS: <span class="progress-bar" id="progress">[░░░░░░░░░░░░░░░░░░░░] 0%</span></div>
            </div>
            
            <button class="demo-button" onclick="demoStartup()">Show Startup</button>
            <button class="demo-button" onclick="demoTesting()">Show Testing</button>
            <button class="demo-button" onclick="demoDecisions()">Show AI Decisions</button>
            <button class="demo-button" onclick="demoCompletion()">Show Completion</button>
        </div>
        
        <div class="demo-section">
            <h2>2. LED Indicator System</h2>
            <div style="text-align: center; padding: 20px;">
                <div style="margin: 10px 0;">
                    <span class="led-indicator yellow" id="tone-led"></span> TONE
                    <span class="led-indicator blue" id="response-led"></span> RESPONSE
                    <span class="led-indicator green" id="test-led"></span> TEST
                    <span class="led-indicator red pulsing" id="ai-led"></span> AI ACTIVE
                </div>
            </div>
            
            <button class="demo-button" onclick="demoLEDs()">Animate LEDs</button>
        </div>
        
        <div class="demo-section">
            <h2>3. Clinical Status Panel</h2>
            <div class="status-panel" id="clinical-status">
                <div>CURRENT TEST STATUS:</div>
                <div>EAR: RIGHT</div>
                <div>FREQUENCY: 1000 HZ</div>
                <div>INTENSITY: 40 DB HL</div>
                <div>STATE: READY</div>
                <div>CONFIDENCE: EXCELLENT</div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>4. Message Flow Examples</h2>
            <div class="crt-display" id="message-flow" style="height: 300px; overflow-y: auto;">
                <div class="message-line">Click buttons above to see different message flows...</div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>5. Clinical Report Preview</h2>
            <button class="demo-button" onclick="showClinicalReport()">Generate Sample Report</button>
        </div>
    </div>

    <script type="module">
        import { GuidanceSystem, ClinicalReportGenerator } from './src/ui/GuidanceSystem.js';
        
        const guidance = new GuidanceSystem();
        const reportGen = new ClinicalReportGenerator();
        
        let currentDemo = null;
        
        window.demoStartup = async function() {
            const display = document.getElementById('ai-command');
            const messages = guidance.messageTemplates.STARTUP;
            
            for (const message of messages) {
                await typeMessage(message, display);
                await delay(800);
            }
        };
        
        window.demoTesting = async function() {
            const display = document.getElementById('ai-command');
            const messages = guidance.messageTemplates.TESTING;
            
            // Update status
            document.getElementById('status').textContent = 'TESTING';
            document.getElementById('ai-status').textContent = 'ACTIVE';
            
            for (const message of messages) {
                await typeMessage(message, display);
                await delay(1000);
            }
        };
        
        window.demoDecisions = async function() {
            const display = document.getElementById('ai-command');
            const decisions = [
                { type: 'INTENSITY_INCREASE', from: 30, to: 40, reason: 'No response detected' },
                { type: 'INTENSITY_DECREASE', from: 40, to: 35, reason: 'Response detected' },
                { type: 'THRESHOLD_CONFIRMED', threshold: 35, confidence: 0.92 },
                { type: 'FREQUENCY_CHANGE', from: 1000, to: 2000 }
            ];
            
            for (const decision of decisions) {
                const formatted = guidance.formatClinicalDecision(decision);
                await typeMessage(formatted, display);
                
                // Update parameters
                if (decision.to) {
                    document.getElementById('level').textContent = decision.to;
                }
                if (decision.type === 'FREQUENCY_CHANGE') {
                    document.getElementById('freq').textContent = decision.to;
                }
                
                await delay(1500);
            }
        };
        
        window.demoCompletion = async function() {
            const display = document.getElementById('ai-command');
            const messages = guidance.messageTemplates.POST_TEST;
            
            document.getElementById('status').textContent = 'COMPLETE';
            document.getElementById('progress').textContent = '[████████████████████] 100%';
            
            for (const message of messages) {
                await typeMessage(message, display);
                await delay(800);
            }
        };
        
        window.demoLEDs = async function() {
            const leds = {
                tone: document.getElementById('tone-led'),
                response: document.getElementById('response-led'),
                test: document.getElementById('test-led'),
                ai: document.getElementById('ai-led')
            };
            
            // Simulate test sequence
            leds.test.classList.add('active');
            await delay(500);
            
            leds.tone.classList.add('active');
            await delay(1000);
            leds.tone.classList.remove('active');
            
            await delay(300);
            leds.response.classList.add('active');
            await delay(200);
            leds.response.classList.remove('active');
            
            await delay(1000);
            leds.test.classList.remove('active');
        };
        
        window.showClinicalReport = function() {
            const sampleResults = {
                'right_1000': { threshold: 30, confidence: 0.9 },
                'left_1000': { threshold: 35, confidence: 0.85 },
                'right_2000': { threshold: 35, confidence: 0.88 },
                'left_2000': { threshold: 40, confidence: 0.82 }
            };
            
            const qualityMetrics = {
                overallConfidence: 0.86,
                reliability: 0.9,
                consistency: 0.8,
                malingeringRisk: 0.1,
                averageResponseTime: 650
            };
            
            const report = reportGen.generateReport(sampleResults, qualityMetrics);
            
            const reportWindow = window.open('', 'ClinicalReport', 'width=800,height=600,scrollbars=yes');
            const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Clinical Audiometry Report</title>
                    <style>
                        body {
                            font-family: 'Courier New', monospace;
                            background: #001100;
                            color: #33ff33;
                            padding: 20px;
                            line-height: 1.4;
                            margin: 0;
                        }
                        .report-container {
                            background: #002200;
                            border: 2px solid #33ff33;
                            padding: 30px;
                            border-radius: 10px;
                            box-shadow: 0 0 20px rgba(51, 255, 51, 0.3);
                        }
                        .report-line {
                            margin: 5px 0;
                            white-space: pre;
                        }
                        .print-button {
                            background: #33ff33;
                            color: #001100;
                            border: none;
                            padding: 10px 20px;
                            font-family: 'Courier New', monospace;
                            font-weight: bold;
                            cursor: pointer;
                            margin: 20px 0;
                            border-radius: 5px;
                        }
                        .print-button:hover {
                            background: #44ff44;
                        }
                        @media print {
                            body { background: white; color: black; }
                            .report-container { border-color: black; background: white; }
                            .print-button { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="report-container">
                        <button class="print-button" onclick="window.print()">PRINT REPORT</button>
                        ${report.map(line => `<div class="report-line">${line}</div>`).join('')}
                        <button class="print-button" onclick="window.print()">PRINT REPORT</button>
                    </div>
                </body>
                </html>
            `;
            
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        };
        
        async function typeMessage(message, element, speed = 30) {
            element.textContent = '';
            element.classList.add('typewriter');
            
            for (let i = 0; i < message.length; i++) {
                element.textContent += message.charAt(i);
                await delay(speed);
            }
            
            element.classList.remove('typewriter');
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Initialize demo
        console.log('Guidance System Demo loaded');
    </script>
</body>
</html>